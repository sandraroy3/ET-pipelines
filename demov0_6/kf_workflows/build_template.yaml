#do not edit this file. All place holders are assigned in the build-push-automate.sh.
apiVersion: v1
kind: Pod
metadata:
# name of the pod
  name: kf-pipelines-${current_step}
  annotations:
    sidecar.istio.io/inject: "false"
spec:
  containers:
  - name: kaniko
    image: gcr.io/kaniko-project/executor:fix_769 # kaniko image from gcr
    imagePullPolicy: Always
    args: ["--dockerfile=/workspace/${path_to_dockerfile}",
            "--context=dir://${folder_dockerfile_is_in}",
            "--verbosity=trace",
            "--skip-tls-verify",
            "--insecure-registry=${server_url}",
            "--skip-tls-verify-registry=${server_url}",
            "--destination=${server_url}/${repository}/${image_name}:${version_number}",
            "--build-arg=dockerfile_base_image=${dockerfile_base_image}"
            ]
    volumeMounts:
      - name: kaniko-volume
        mountPath: /kaniko/.docker
      - name: dockerfile-storage
        mountPath: /workspace
  restartPolicy: Never
  volumes:
    - name: kaniko-volume
      secret:
        secretName: ${docker_secret} # dockerhub secret
        items:
          - key: .dockerconfigjson
            path: config.json
    - name: dockerfile-storage
      persistentVolumeClaim:
        claimName: ${notebook_claimName}